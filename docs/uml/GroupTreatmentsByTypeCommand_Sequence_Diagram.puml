@startuml
title GroupTreatmentsByTypeCommand â€” Sequence Diagram (concise, no notes)
actor User
participant ":CuddleCare" as CuddleCare
participant ":Parser" as Parser
participant ":CommandWithArguments" as CWA
participant ":GroupTreatmentsByTypeCommand" as GTC
participant ":PetList" as PetList
participant ":Ui" as Ui

User -> CuddleCare : group-treatments-by-type [args]
activate CuddleCare
CuddleCare -> Parser : parse(input)
activate Parser
Parser --> CuddleCare : CWA(GTC,args)
deactivate Parser

CuddleCare -> CWA : exec()
activate CWA
CWA -> GTC : exec(args)
activate GTC

alt filter provided (n/PET_NAME)
  GTC -> PetList : getPetByName(name)
  activate PetList
  PetList --> GTC : Pet / null
  deactivate PetList
  alt pet not found
    GTC --> CWA : "No such pet"
  else pet found
    GTC -> GTC : process rows (flatten + group by type)
    activate GTC
    GTC --> GTC : done
    deactivate GTC
  end
else no filter
  GTC -> PetList : toList()
  activate PetList
  PetList --> GTC : List<Pet>
  deactivate PetList
  GTC -> GTC : process rows (flatten + group by type)
  activate GTC
  GTC --> GTC : done
  deactivate GTC
end

alt no treatments
  GTC --> CWA : "No treatments logged"
else grouped results
  GTC --> CWA : print groups by type
end
GTC -> Ui : prints
deactivate GTC
activate Ui
CWA --> CuddleCare : return
deactivate CWA
deactivate CuddleCare
Ui --> User : prints
deactivate Ui
@enduml